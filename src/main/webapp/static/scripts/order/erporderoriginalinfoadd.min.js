webpackJsonp([134],{GVGe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("Dd8w"),a=i.n(o),s=i("7+uW"),n=i("woOf"),r=i.n(n),l=i("mtWM"),c=i.n(l),d={data:function(){return{info:{goodType:"",orderType:"",orderNumber:"",buyDate:"",realPrice:0,shopId:"",shopName:"",shopNumber:"",shopAbbreviation:"",industryType:"",contactName:"",contactNumber:"",serviceProvider:"",remark:"",agentId:"",agentName:"",isNewShop:"N",shopExtensionId:"",erpOrderOriginalGoods:[],pendingNum:0},orderId:erpApp.getQueryString("id"),erpOrderOriginalGoods:[{number:1,vals:{}}],productsVals:[],goodType:"",serviceTypes:[],orderTypes:[{name:"直销",value:"1"},{name:"服务商",value:"2"}],diot:"*",isSaveing:!1,isCkl:!1,cklGoodList:[],jykGoodList:[],hasPermissionKcl:erpOrderOriginalInfoAdd.hasPermissionKcl,hasPermissionJyk:erpOrderOriginalInfoAdd.hasPermissionJyk}},computed:{isNewShop:function(){return"Y"===this.info.isNewShop}},watch:{goodType:function(t){var e="6"===t;this.isCkl=e,this.info.goodType=t,e?(this.info.isNewShop="N",this.info.orderType="1",this.productsVals=this.cklGoodList):this.productsVals=this.jykGoodList},isNewShop:function(t){this.info.contactName=t?"":this.info.contactName,this.info.contactNumber=t?"":this.info.contactNumber,this.info.shopName=t?"":this.info.shopName,this.info.shopNumber=t?"":this.info.shopNumber,this.info.agentId=t?"":this.info.agentId,this.info.agentName=t?"":this.info.agentName}},mounted:function(){this.info.orderNumber=this.makeOrderNumber(),this.hasPermissionJyk&&(this.serviceTypes.push({name:"聚引客",value:"5"}),this.queryGoodList("5")),this.hasPermissionKcl&&(this.serviceTypes.push({name:"常客来",value:"6"}),this.queryGoodList("6"))},methods:{queryGoodList:function(t){var e=this;c.a.get(ctx+"/order/erpOrderOriginalInfo/queryGoodList",{params:{goodType:t}}).then(function(i){Array.isArray(i.data)&&("6"===t?e.cklGoodList=i.data:e.jykGoodList=i.data)})},createOrder:function(){var t=this;if(!this.isSaveing){this.isSaveing=!0;var e={goodType:"请选择订单类型！",orderType:"请选择订单类别！",orderNumber:"请填写订单编号！",buyDate:"请选择购买时间！",realPrice:"请填写订单金额！",shopName:"请选择商户！",agentName:"请填写服务商！"};for(var i in this.isNewShop&&(this.info.shopId=this.info.contactNumber,e=r()({},e,{shopName:"请填写商户名称！",contactName:"请填写商户联系人！",contactNumber:"请填写商户联系电话（手机）！"})),e){if(!this.info[i])return erpApp.tip(e[i]),void(this.isSaveing=!1);if("contactNumber"===i&&!/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/.test(this.info[i]))return erpApp.tip("商户联系手机号格式不对！"),void(this.isSaveing=!1);if("realPrice"===i&&!/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/.test(this.info[i]))return erpApp.tip("请输入合法的订单金额！"),void(this.isSaveing=!1)}for(var o=0,a=this.erpOrderOriginalGoods.length;o<a;o++){var s=this.erpOrderOriginalGoods[o];if(!s.vals.hasOwnProperty("id"))return erpApp.tip("请选择第"+(o+1)+"个商品！"),void(this.isSaveing=!1);if("number"!=typeof s.number||s.number<=0)return erpApp.tip("请选择第"+(o+1)+"个商品的数量！"),void(this.isSaveing=!1);this.info.erpOrderOriginalGoods.push({goodId:s.vals.id,goodName:s.vals.name,goodTypeId:s.vals.categoryId,goodTypeName:s.vals.categoryName,num:s.number,realPrice:s.vals.price}),this.info.pendingNum=this.info.pendingNum+s.number}c.a.post(ctx+"/order/erpOrderOriginalInfo/add",this.info).then(function(e){"success"===e.data.returnCode?(erpApp.tip(e.data.returnMessage||"提交成功！"),setTimeout(function(){t.isSaveing=!1,location.reload()},3e3)):(erpApp.tip(e.data.returnMessage||"提交失败！"),t.isSaveing=!1)}).catch(function(e){erpApp.tip("提交失败，请稍后重试！"),t.isSaveing=!1})}},makeOrderNumber:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,o=t.getDate(),a=t.getHours(),s=t.getMinutes(),n=t.getSeconds(),r="",l=function(t){return t>9?t:"0"+t};return r=(r+e+l(i)+l(o)+l(a)+l(s)+l(n)).slice(2)},productContorl:function(t){if("add"===t)this.erpOrderOriginalGoods.push({number:1,vals:{}});else{if(1===this.erpOrderOriginalGoods.length)return void erpApp.tip("最少要添加一个商品！");this.erpOrderOriginalGoods.splice(t,1)}},selectShop:function(){var t=this;if(this.isNewShop)erpApp.tip("新商户请直接输入商户名称！");else{erpOrderOriginalInfoAdd.selectShop(function(e){t.info.shopId=e.shopid,t.info.shopName=e.shopname,t.info.shopNumber=e.shopnumber,t.info.shopAbbreviation=e.shopshortname,t.info.shopExtensionId=e.zhangbeiId,t.info.contactNumber=e.contactPhone,t.info.contactName=e.contactName,t.info.agentId=e.agentId,t.info.agentName=e.agentName})}},agentSearchList:function(){var t=this;if(this.isNewShop){erpOrderOriginalInfoAdd.agentSearchList(function(e){t.info.agentId=e.agentId,t.info.agentName=e.agentName})}},changebuyDate:function(t){this.info.buyDate=t.target.value},comeback:function(){history.go(-1)}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"formwrapper positionrelative margin-top-20"},[i("div",{staticClass:"form-horizontal",attrs:{id:"inputForm"}},[i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("订单类型：")]),t._v(" "),i("div",{staticClass:"controls"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.goodType,expression:"goodType"}],staticClass:"required input-medium",on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.goodType=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"",label:"请选择"}},[t._v("请选择")]),t._v(" "),t._l(t.serviceTypes,function(e,o){return i("option",{key:"serviceTypes"+o,domProps:{value:e.value}},[t._v(t._s(e.name))])})],2),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("订单类别：")]),t._v(" "),i("div",{staticClass:"controls"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.info.orderType,expression:"info.orderType"}],staticClass:"required input-medium",attrs:{disabled:t.isCkl},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.info,"orderType",e.target.multiple?i:i[0])}}},[i("option",{attrs:{value:""}},[t._v("请选择")]),t._v(" "),t._l(t.orderTypes,function(e,o){return i("option",{key:"orderTypes"+o,domProps:{value:e.value}},[t._v(t._s(e.name))])})],2),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("订单编号：")]),t._v(" "),i("div",{staticClass:"controls"},[i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.orderNumber,expression:"info.orderNumber",modifiers:{trim:!0}}],staticClass:"required input-xlarge",attrs:{type:"text",maxlength:"50"},domProps:{value:t.info.orderNumber},on:{input:function(e){e.target.composing||t.$set(t.info,"orderNumber",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("购买时间：")]),t._v(" "),i("div",{staticClass:"controls"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.info.buyDate,expression:"info.buyDate"}],staticClass:"required input-xlarge Wdate",attrs:{id:"buyDate",name:"buyDate",onclick:"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',isShowClear:false,readOnly:true});",type:"text",maxlength:"20",readonly:"readonly"},domProps:{value:t.info.buyDate},on:{focus:function(e){t.changebuyDate(e)},input:function(e){e.target.composing||t.$set(t.info,"buyDate",e.target.value)}}}),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("订单金额：")]),t._v(" "),i("div",{staticClass:"controls"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.info.realPrice,expression:"info.realPrice",modifiers:{number:!0}}],staticClass:"required input-xlarge",attrs:{type:"number",maxlength:"12",min:"0"},domProps:{value:t.info.realPrice},on:{input:function(e){e.target.composing||t.$set(t.info,"realPrice",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("是否是新商户：")]),t._v(" "),i("div",{staticClass:"controls"},[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.info.isNewShop,expression:"info.isNewShop"}],staticClass:"isnewshop",attrs:{type:"radio",value:"Y",disabled:t.isCkl},domProps:{checked:t._q(t.info.isNewShop,"Y")},on:{change:function(e){t.$set(t.info,"isNewShop","Y")}}}),t._v("是")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.info.isNewShop,expression:"info.isNewShop"}],staticClass:"isnewshop",attrs:{type:"radio",value:"N"},domProps:{checked:t._q(t.info.isNewShop,"N")},on:{change:function(e){t.$set(t.info,"isNewShop","N")}}}),t._v("否")])])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("商户：")]),t._v(" "),i("div",{staticClass:"controls"},[i("div",{staticClass:"input-append"},[i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.shopName,expression:"info.shopName",modifiers:{trim:!0}}],staticClass:"required input-xlarge",attrs:{readonly:!t.isNewShop,type:"text",value:"选择商户"},domProps:{value:t.info.shopName},on:{input:function(e){e.target.composing||t.$set(t.info,"shopName",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("a",{staticClass:"btn",attrs:{href:"javascript:;"},on:{click:t.selectShop}},[i("i",{staticClass:"icon-search"})])]),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isNewShop,expression:"isNewShop"}],staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("商户联系人：")]),t._v(" "),i("div",{staticClass:"controls"},[i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.contactName,expression:"info.contactName",modifiers:{trim:!0}}],staticClass:"input-xlarge",attrs:{type:"text",maxlength:"50"},domProps:{value:t.info.contactName},on:{input:function(e){e.target.composing||t.$set(t.info,"contactName",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isNewShop,expression:"isNewShop"}],staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("商户联系电话（手机）：")]),t._v(" "),i("div",{staticClass:"controls"},[i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.contactNumber,expression:"info.contactNumber",modifiers:{trim:!0}}],staticClass:"input-xlarge",attrs:{type:"text",maxlength:"13"},domProps:{value:t.info.contactNumber},on:{input:function(e){e.target.composing||t.$set(t.info,"contactNumber",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("服务商：")]),t._v(" "),i("div",{staticClass:"controls"},[i("div",{staticClass:"input-append"},[i("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.agentName,expression:"info.agentName",modifiers:{trim:!0}}],staticClass:"required input-xlarge",attrs:{readonly:"readonly",type:"text",value:"选择服务商"},domProps:{value:t.info.agentName},on:{input:function(e){e.target.composing||t.$set(t.info,"agentName",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("a",{staticClass:"btn",attrs:{href:"javascript:;"},on:{click:t.agentSearchList}},[i("i",{staticClass:"icon-search"})])]),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),i("div",{staticClass:"control-group addItem addproductitem"},[i("label",{staticClass:"control-label"},[t._v("购买的商品：")]),t._v(" "),i("div",{staticClass:"controls"},t._l(t.erpOrderOriginalGoods,function(e,o){return i("div",{key:"productsVal"+o,staticClass:"margin-bottom-10"},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.vals,expression:"item.vals"}],staticClass:"products input-medium",on:{change:function(i){var o=Array.prototype.filter.call(i.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"vals",i.target.multiple?o:o[0])}}},[i("option",{domProps:{value:{}}},[t._v("请选择")]),t._v(" "),t._l(t.productsVals,function(e,o){return i("option",{key:"productsVals"+o,domProps:{value:e}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.name)+"\n\t\t\t\t\t\t")])})],2),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.number,expression:"item.number",modifiers:{number:!0}}],staticClass:"addproductnum input-addproductnum",attrs:{type:"number",name:"buyCounts",min:"1"},domProps:{value:e.number},on:{input:function(i){i.target.composing||t.$set(e,"number",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("button",{staticClass:"btn minus",attrs:{type:"button",title:"删除该商品"},on:{click:function(e){t.productContorl(o)}}},[t._v("-")]),t._v(" "),i("button",{staticClass:"btn addProduct",attrs:{type:"button",title:"添加一个商品"},on:{click:function(e){t.productContorl("add")}}},[t._v("+")]),t._v(" "),i("span",{staticClass:"help-inline"},[i("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])}))]),t._v(" "),i("div",{staticClass:"control-group"},[i("label",{staticClass:"control-label"},[t._v("备注：")]),t._v(" "),i("div",{staticClass:"controls"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.info.remark,expression:"info.remark"}],staticClass:"input-xxlarge",attrs:{rows:"3",maxlength:"256"},domProps:{value:t.info.remark},on:{input:function(e){e.target.composing||t.$set(t.info,"remark",e.target.value)}}})])]),t._v(" "),i("div",{staticClass:"form-actions"},[i("input",{staticClass:"btn btn-primary",attrs:{type:"button",value:"确定并提交"},on:{click:t.createOrder}})])])])},staticRenderFns:[]},u=i("VU/8")(d,p,!1,null,null,null).exports;s.default.config.productionTip=!1,s.default.config.devtools=!1,new s.default(a()({},u)).$mount("#rootNode")}},["GVGe"]);