webpackJsonp([133],{"22Qu":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("Dd8w"),a=o.n(i),r=o("7+uW"),n=o("woOf"),s=o.n(n),l=o("mvHQ"),d=o.n(l),c=o("mtWM"),p=o.n(c),u={data:function(){return{info:{goodType:"",orderType:"",orderNumber:"",buyDate:"",realPrice:0,shopId:"",shopName:"",shopNumber:"",shopAbbreviation:"",industryType:"",contactName:"",contactNumber:"",serviceProvider:"",remark:"",agentId:"",agentName:"",isNewShop:"N",shopExtensionId:"",erpOrderOriginalGoods:[],pendingNum:0},erpOrderOriginalGoods:[{number:1,vals:{}}],productsVals:[],goodType:"",serviceTypes:[{name:"聚引客",value:"5"},{name:"客常来",value:"6"}],orderTypes:[{name:"直销",value:"1"},{name:"服务商",value:"2"}],diot:"*",isSaveing:!1,isCkl:!1,orderId:erpShopApp.getQueryString("orderId",location.href),reason:""}},computed:{isNewShop:function(){return"Y"===this.info.isNewShop},disabled:function(){return"6"==this.info.goodType}},watch:{isNewShop:function(t){this.info.contactName=t?"":this.info.contactName,this.info.contactNumber=t?"":this.info.contactNumber,this.info.shopName=t?"":this.info.shopName,this.info.shopNumber=t?"":this.info.shopNumber,this.info.agentId=t?"":this.info.agentId,this.info.agentName=t?"":this.info.agentName}},mounted:function(){this.info.orderNumber=this.makeOrderNumber(),this.getData()},methods:{getData:function(){var t=this;p.a.get(ctx+"/order/erpOrderOriginalInfo/getOrderAndGood?orderId="+this.orderId).then(function(e){e.data&&(e.data.hasOwnProperty("order")&&(t.info=JSON.parse(d()(e.data.order)),t.info.erpOrderOriginalGoods=[],e.data.order.erpOrderOriginalGoods.forEach(function(e){t.info.erpOrderOriginalGoods.push({goodId:e.goodId,goodName:e.goodName,goodTypeId:e.goodTypeId,goodTypeName:e.goodTypeName,num:e.num,realPrice:e.realPrice})})),t.reason=e.data.reason,t.queryGoodList())})},queryGoodList:function(){var t=this;p.a.get(ctx+"/order/erpOrderOriginalInfo/queryGoodList",{params:{goodType:this.info.goodType}}).then(function(e){Array.isArray(e.data)&&e.data.forEach(function(e){t.productsVals.push({goodId:e.id,goodName:e.name,goodTypeId:e.categoryId,goodTypeName:e.categoryName,num:1,realPrice:e.price})})})},createOrder:function(){var t=this;if(!this.isSaveing){this.isSaveing=!0;var e={goodType:"请选择订单类型！",orderType:"请选择订单类别！",orderNumber:"请填写订单编号！",buyDate:"请选择购买时间！",realPrice:"请填写订单金额！",shopName:"请选择商户！",agentName:"请填写服务商！"};for(var o in this.isNewShop&&(this.info.shopId=this.info.contactNumber,e=s()({},e,{shopName:"请填写商户名称！",contactName:"请填写商户联系人！",contactNumber:"请填写商户联系电话（手机）！"})),e){if(!this.info[o])return erpApp.tip(e[o]),void(this.isSaveing=!1);if("contactNumber"===o&&!/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/.test(this.info[o]))return erpApp.tip("商户联系手机号格式不对！"),void(this.isSaveing=!1);if("realPrice"===o&&!/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/.test(this.info[o]))return erpApp.tip("请输入合法的订单金额！"),void(this.isSaveing=!1)}for(var i=0,a=this.info.erpOrderOriginalGoods.length;i<a;i++){var r=this.info.erpOrderOriginalGoods[i];if(r.num?r.num=parseInt(r.num):r.num=0,!r.goodId)return erpApp.tip("请选择第"+(i+1)+"个商品！"),void(this.isSaveing=!1);if("number"!=typeof r.num||r.num<=0)return erpApp.tip("第"+(i+1)+"个商品的数量不合法！"),void(this.isSaveing=!1);this.info.pendingNum=this.info.pendingNum+r.num}p.a.post(ctx+"/order/flow/modify_order_info?auditResult=Return&orderId="+this.orderId+"&procInsId="+this.info.procInsId,this.info).then(function(e){e.data.result?(erpApp.tip(e.data.returnMessage||"修改成功！"),location.href=ctx+"/order/erpOrderOriginalInfo/orderAuditForm"):erpApp.tip(e.data.returnMessage||"修改失败！"),t.isSaveing=!1}).catch(function(e){erpApp.tip("提交失败，请稍后重试！"),t.isSaveing=!1})}},cancelOrder:function(){var t=this;popup.confirm({title:"提示",message:"确认删除该订单数据?",confirmCallBack:function(){p.a.post(ctx+"/order/flow/modify_order_info?auditResult=Delete&orderId="+t.orderId+"&procInsId="+t.info.procInsId,t.info).then(function(e){e.data.result?(erpApp.tip(e.data.returnMessage||"取消成功！"),location.href=ctx+"/order/erpOrderOriginalInfo/orderAuditForm"):erpApp.tip(e.data.returnMessage||"取消失败！"),t.isSaveing=!1}).catch(function(e){erpApp.tip("提交失败，请稍后重试！"),t.isSaveing=!1})}})},makeOrderNumber:function(){var t=new Date,e=t.getFullYear(),o=t.getMonth()+1,i=t.getDate(),a=t.getHours(),r=t.getMinutes(),n=t.getSeconds(),s="",l=function(t){return t>9?t:"0"+t};return s=(s+e+l(o)+l(i)+l(a)+l(r)+l(n)).slice(2)},productContorl:function(t){if("add"===t)this.info.erpOrderOriginalGoods.push({num:1});else{if(1===this.info.erpOrderOriginalGoods.length)return void erpApp.tip("最少要添加一个商品！");this.info.erpOrderOriginalGoods.splice(t,1)}},selectShop:function(){var t=this;if(this.isNewShop)erpApp.tip("新商户请直接输入商户名称！");else{erpOrderOriginalInfoAdd.selectShop(function(e){t.info.shopId=e.shopid,t.info.shopName=e.shopname,t.info.shopNumber=e.shopnumber,t.info.shopAbbreviation=e.shopshortname,t.info.shopExtensionId=e.zhangbeiId,t.info.contactNumber=e.contactPhone,t.info.contactName=e.contactName,t.info.agentId=e.agentId,t.info.agentName=e.agentName})}},agentSearchList:function(){var t=this;if(this.isNewShop){erpOrderOriginalInfoAdd.agentSearchList(function(e){t.info.agentId=e.agentId,t.info.agentName=e.agentName})}},changebuyDate:function(t){this.info.buyDate=t.target.value},comeback:function(){history.go(-1)},selectGoods:function(t,e){var o=this;t.goodId?this.productsVals.forEach(function(i,a){i.goodId==t.goodId&&(o.info.erpOrderOriginalGoods[e]=JSON.parse(d()(i)),t.num&&(o.info.erpOrderOriginalGoods[e].num=parseInt(t.num)))}):this.info.erpOrderOriginalGoods[e]={goodId:"",num:1}}}},m={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"formwrapper positionrelative margin-top-20"},[t._m(0),t._v(" "),o("div",{staticClass:"form-horizontal",attrs:{id:"inputForm"}},[o("div",{staticClass:"audit-content"},[o("p",[t._v("审核不通过反馈")]),t._v(" "),o("p",[o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.reason,expression:"reason"}],attrs:{disabled:!0},domProps:{value:t.reason},on:{input:function(e){e.target.composing||(t.reason=e.target.value)}}})])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("订单类型：")]),t._v(" "),o("div",{staticClass:"controls"},[o("select",{directives:[{name:"model",rawName:"v-model",value:t.info.goodType,expression:"info.goodType"}],staticClass:"required input-medium",attrs:{disabled:!0},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.info,"goodType",e.target.multiple?o:o[0])}}},[o("option",{attrs:{value:"",label:"请选择"}},[t._v("请选择")]),t._v(" "),t._l(t.serviceTypes,function(e,i){return o("option",{key:"serviceTypes"+i,domProps:{value:e.value}},[t._v(t._s(e.name))])})],2),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("订单类别：")]),t._v(" "),o("div",{staticClass:"controls"},[o("select",{directives:[{name:"model",rawName:"v-model",value:t.info.orderType,expression:"info.orderType"}],staticClass:"required input-medium",attrs:{disabled:t.disabled},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.info,"orderType",e.target.multiple?o:o[0])}}},[o("option",{attrs:{value:""}},[t._v("请选择")]),t._v(" "),t._l(t.orderTypes,function(e,i){return o("option",{key:"orderTypes"+i,domProps:{value:e.value}},[t._v(t._s(e.name))])})],2),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("订单编号：")]),t._v(" "),o("div",{staticClass:"controls"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.orderNumber,expression:"info.orderNumber",modifiers:{trim:!0}}],staticClass:"required input-xlarge",attrs:{type:"text",maxlength:"50"},domProps:{value:t.info.orderNumber},on:{input:function(e){e.target.composing||t.$set(t.info,"orderNumber",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("购买时间：")]),t._v(" "),o("div",{staticClass:"controls"},[o("input",{directives:[{name:"model",rawName:"v-model",value:t.info.buyDate,expression:"info.buyDate"}],staticClass:"required input-xlarge Wdate",attrs:{id:"buyDate",name:"buyDate",onclick:"WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',isShowClear:false,readOnly:true});",type:"text",maxlength:"20",readonly:"readonly"},domProps:{value:t.info.buyDate},on:{focus:function(e){t.changebuyDate(e)},input:function(e){e.target.composing||t.$set(t.info,"buyDate",e.target.value)}}}),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("订单金额：")]),t._v(" "),o("div",{staticClass:"controls"},[o("input",{directives:[{name:"model",rawName:"v-model.number",value:t.info.realPrice,expression:"info.realPrice",modifiers:{number:!0}}],staticClass:"required input-xlarge",attrs:{type:"number",maxlength:"12",min:"0"},domProps:{value:t.info.realPrice},on:{input:function(e){e.target.composing||t.$set(t.info,"realPrice",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("是否是新商户：")]),t._v(" "),o("div",{staticClass:"controls"},[o("label",[o("input",{directives:[{name:"model",rawName:"v-model",value:t.info.isNewShop,expression:"info.isNewShop"}],staticClass:"isnewshop",attrs:{type:"radio",value:"Y",disabled:t.disabled},domProps:{checked:t._q(t.info.isNewShop,"Y")},on:{change:function(e){t.$set(t.info,"isNewShop","Y")}}}),t._v("是")]),t._v(" "),o("label",[o("input",{directives:[{name:"model",rawName:"v-model",value:t.info.isNewShop,expression:"info.isNewShop"}],staticClass:"isnewshop",attrs:{type:"radio",value:"N"},domProps:{checked:t._q(t.info.isNewShop,"N")},on:{change:function(e){t.$set(t.info,"isNewShop","N")}}}),t._v("否")])])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("商户：")]),t._v(" "),o("div",{staticClass:"controls"},[o("div",{staticClass:"input-append"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.shopName,expression:"info.shopName",modifiers:{trim:!0}}],staticClass:"required input-xlarge",attrs:{readonly:!t.isNewShop,type:"text",value:"选择商户"},domProps:{value:t.info.shopName},on:{input:function(e){e.target.composing||t.$set(t.info,"shopName",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),o("a",{staticClass:"btn",attrs:{href:"javascript:;"},on:{click:t.selectShop}},[o("i",{staticClass:"icon-search"})])]),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.isNewShop,expression:"isNewShop"}],staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("商户联系人：")]),t._v(" "),o("div",{staticClass:"controls"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.contactName,expression:"info.contactName",modifiers:{trim:!0}}],staticClass:"input-xlarge",attrs:{type:"text",maxlength:"50"},domProps:{value:t.info.contactName},on:{input:function(e){e.target.composing||t.$set(t.info,"contactName",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.isNewShop,expression:"isNewShop"}],staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("商户联系电话（手机）：")]),t._v(" "),o("div",{staticClass:"controls"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.contactNumber,expression:"info.contactNumber",modifiers:{trim:!0}}],staticClass:"input-xlarge",attrs:{type:"text",maxlength:"13"},domProps:{value:t.info.contactNumber},on:{input:function(e){e.target.composing||t.$set(t.info,"contactNumber",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("服务商：")]),t._v(" "),o("div",{staticClass:"controls"},[o("div",{staticClass:"input-append"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.info.agentName,expression:"info.agentName",modifiers:{trim:!0}}],staticClass:"required input-xlarge",attrs:{readonly:"readonly",type:"text",value:"选择服务商"},domProps:{value:t.info.agentName},on:{input:function(e){e.target.composing||t.$set(t.info,"agentName",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),o("a",{staticClass:"btn",attrs:{href:"javascript:;"},on:{click:t.agentSearchList}},[o("i",{staticClass:"icon-search"})])]),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])]),t._v(" "),o("div",{staticClass:"control-group addItem addproductitem"},[o("label",{staticClass:"control-label"},[t._v("购买的商品：")]),t._v(" "),o("div",{staticClass:"controls"},t._l(t.info.erpOrderOriginalGoods,function(e,i){return o("div",{key:"productsVal"+i,staticClass:"margin-bottom-10"},[o("select",{directives:[{name:"model",rawName:"v-model",value:e.goodId,expression:"item.goodId"}],staticClass:"products input-medium",on:{change:[function(o){var i=Array.prototype.filter.call(o.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"goodId",o.target.multiple?i:i[0])},function(o){t.selectGoods(e,i)}]}},[o("option",{attrs:{value:""}},[t._v("请选择")]),t._v(" "),t._l(t.productsVals,function(e,i){return o("option",{key:"productsVals"+i,domProps:{value:e.goodId}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.goodName)+"\n\t\t\t\t\t\t")])})],2),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.num,expression:"item.num"}],staticClass:"addproductnum input-addproductnum",attrs:{type:"number",name:"buyCounts",min:"1"},domProps:{value:e.num},on:{input:function(o){o.target.composing||t.$set(e,"num",o.target.value)}}}),t._v(" "),o("button",{staticClass:"btn minus",attrs:{type:"button",title:"删除该商品"},on:{click:function(e){t.productContorl(i)}}},[t._v("-")]),t._v(" "),o("button",{staticClass:"btn addProduct",attrs:{type:"button",title:"添加一个商品"},on:{click:function(e){t.productContorl("add")}}},[t._v("+")]),t._v(" "),o("span",{staticClass:"help-inline"},[o("font",{attrs:{color:"red"}},[t._v(t._s(t.diot))])],1)])}))]),t._v(" "),o("div",{staticClass:"control-group"},[o("label",{staticClass:"control-label"},[t._v("备注：")]),t._v(" "),o("div",{staticClass:"controls"},[o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.info.remark,expression:"info.remark"}],staticClass:"input-xxlarge",attrs:{rows:"3",maxlength:"256"},domProps:{value:t.info.remark},on:{input:function(e){e.target.composing||t.$set(t.info,"remark",e.target.value)}}})])]),t._v(" "),o("div",{staticClass:"form-actions"},[o("input",{staticClass:"btn btn-primary",attrs:{type:"button",value:"确定并提交"},on:{click:t.createOrder}}),t._v(" "),o("input",{staticClass:"btn",attrs:{type:"button",value:"取消订单"},on:{click:t.cancelOrder}})])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"nav nav-tabs"},[e("li",[e("a",{staticClass:"comebacka",attrs:{href:"javascript:history.back()"}},[this._v("返回")])]),this._v(" "),e("li",{staticClass:"active"},[e("a",{attrs:{href:"javascript:;"}},[this._v("订单 修改")])])])}]},v=o("VU/8")(u,m,!1,null,null,null).exports;r.default.config.productionTip=!1,r.default.config.devtools=!1,new r.default(a()({},v)).$mount("#rootNode")}},["22Qu"]);