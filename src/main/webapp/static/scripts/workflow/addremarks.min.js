webpackJsonp([80],{BD2p:function(e,t,r){"use strict";var n=r("bOdI"),s=r.n(n),i={name:"Icon",props:{type:String,size:[Number,String],color:String},computed:{classes:function(){return"ivu-icon ivu-icon-"+this.type},styles:function(){var e={};return this.size&&(e["font-size"]=this.size+"px"),this.color&&(e.color=this.color),e}}},a={render:function(){var e=this.$createElement;return(this._self._c||e)("i",{class:this.classes,style:this.styles})},staticRenderFns:[]},o=r("VU/8")(i,a,!1,null,null,null).exports,c=(r("BO1k"),r("7+uW").default.prototype.$isServer);function u(e,t){for(var r=0;r<t.length;r++)if(e===t[r])return!0;return!1}!c&&(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver);var l={components:{Icon:o},props:{percent:{type:Number,default:0},status:{validator:function(e){return u(e,["normal","active","wrong","success"])},default:"normal"},hideInfo:{type:Boolean,default:!1},strokeWidth:{type:Number,default:10},vertical:{type:Boolean,default:!1}},data:function(){return{currentStatus:this.status}},computed:{isStatus:function(){return"wrong"==this.currentStatus||"success"==this.currentStatus},statusIcon:function(){var e="";switch(this.currentStatus){case"wrong":e="ios-close";break;case"success":e="ios-checkmark"}return e},bgStyle:function(){return this.vertical?{height:this.percent+"%",width:this.strokeWidth+"px"}:{width:this.percent+"%",height:this.strokeWidth+"px"}},wrapClasses:function(){var e;return["ivu-progress","ivu-progress-"+this.currentStatus,(e={},s()(e,"ivu-progress-show-info",!this.hideInfo),s()(e,"ivu-progress-vertical",this.vertical),e)]},textClasses:function(){return"ivu-progress-text"},textInnerClasses:function(){return"ivu-progress-text-inner"},outerClasses:function(){return"ivu-progress-outer"},innerClasses:function(){return"ivu-progress-inner"},bgClasses:function(){return"ivu-progress-bg"}},created:function(){this.handleStatus()},methods:{handleStatus:function(e){e?(this.currentStatus="normal",this.$emit("on-status-change","normal")):100==parseInt(this.percent,10)&&(this.currentStatus="success",this.$emit("on-status-change","success"))}},watch:{percent:function(e,t){e<t?this.handleStatus(!0):this.handleStatus()},status:function(e){this.currentStatus=e}}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:e.wrapClasses},[r("div",{class:e.outerClasses},[r("div",{class:e.innerClasses},[r("div",{class:e.bgClasses,style:e.bgStyle})])]),e._v(" "),e.hideInfo?e._e():r("span",{class:e.textClasses},[e._t("default",[e.isStatus?r("span",{class:e.textInnerClasses},[r("Icon",{attrs:{type:e.statusIcon}})],1):r("span",{class:e.textInnerClasses},[e._v("\n                "+e._s(e.percent)+"%\n            ")])])],2)])},staticRenderFns:[]},m={name:"UploadList",components:{Icon:o,iProgress:r("VU/8")(l,p,!1,null,null,null).exports},props:{files:{type:Array,default:function(){return[]}}},data:function(){return{prefixCls:"ivu-upload"}},methods:{fileCls:function(e){return["ivu-upload-list-file",s()({},"ivu-upload-list-file-finish","finished"===e.status)]},handleClick:function(e){this.$emit("on-file-click",e)},handlePreview:function(e){this.$emit("on-file-preview",e)},handleRemove:function(e){this.$emit("on-file-remove",e)},format:function(e){var t=e.name.split(".").pop().toLocaleLowerCase()||"",r="document";return["gif","jpg","jpeg","png","bmp","webp"].indexOf(t)>-1&&(r="image"),["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(t)>-1&&(r="ios-film"),["mp3","wav","wma","ogg","aac","flac"].indexOf(t)>-1&&(r="ios-musical-notes"),["doc","txt","docx","pages","epub","pdf"].indexOf(t)>-1&&(r="document-text"),["numbers","csv","xls","xlsx"].indexOf(t)>-1&&(r="stats-bars"),["keynote","ppt","pptx"].indexOf(t)>-1&&(r="ios-videocam"),r},parsePercentage:function(e){return parseInt(e,10)}}},d={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",{class:[e.prefixCls+"-list"]},e._l(e.files,function(t){return r("li",{class:e.fileCls(t),on:{click:function(r){e.handleClick(t)}}},[r("span",{on:{click:function(r){e.handlePreview(t)}}},[r("Icon",{attrs:{type:e.format(t)}}),e._v(" "+e._s(t.name)+"\n        ")],1),e._v(" "),r("Icon",{directives:[{name:"show",rawName:"v-show",value:"finished"===t.status,expression:"file.status === 'finished'"}],class:[e.prefixCls+"-list-remove"],attrs:{type:"ios-close-empty"},nativeOn:{click:function(r){e.handleRemove(t)}}}),e._v(" "),r("transition",{attrs:{name:"fade"}},[t.showProgress?r("i-progress",{attrs:{"stroke-width":2,percent:e.parsePercentage(t.percentage),status:"finished"===t.status&&t.showProgress?"success":"normal"}}):e._e()],1)],1)}))},staticRenderFns:[]},f=r("VU/8")(m,d,!1,null,null,null).exports,h=r("fZjL"),v=r.n(h);function g(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function I(e){if("undefined"!=typeof XMLHttpRequest){var t=new XMLHttpRequest,r=e.action;t.upload&&(t.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)});var n=new FormData;e.data&&v()(e.data).map(function(t){n.append(t,e.data[t])}),n.append(e.filename,e.file),t.onerror=function(t){e.onError(t)},t.onload=function(){if(t.status<200||t.status>=300)return e.onError(function(e,t,r){var n="fail to post "+e+" "+r.status+"'",s=new Error(n);return s.status=r.status,s.method="post",s.url=e,s}(r,0,t),g(t));e.onSuccess(g(t))},t.open("post",r,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);var s=e.headers||{};for(var i in s)s.hasOwnProperty(i)&&null!==s[i]&&t.setRequestHeader(i,s[i]);t.send(n)}}var k={name:"Upload",mixins:[{methods:{dispatch:function(e,t,r){for(var n=this.$parent||this.$root,s=n.$options.name;n&&(!s||s!==e);)(n=n.$parent)&&(s=n.$options.name);n&&n.$emit.apply(n,[t].concat(r))},broadcast:function(e,t,r){(function e(t,r,n){this.$children.forEach(function(s){s.$options.name===t?s.$emit.apply(s,[r].concat(n)):e.apply(s,[t,r].concat([n]))})}).call(this,e,t,r)}}}],components:{UploadList:f},props:{action:{type:String,required:!0},headers:{type:Object,default:function(){return{}}},multiple:{type:Boolean,default:!1},data:{type:Object},name:{type:String,default:"file"},withCredentials:{type:Boolean,default:!1},showUploadList:{type:Boolean,default:!0},type:{type:String,validator:function(e){return u(e,["select","drag"])},default:"select"},format:{type:Array,default:function(){return[]}},accept:{type:String},maxSize:{type:Number},beforeUpload:Function,onProgress:{type:Function,default:function(){return{}}},onSuccess:{type:Function,default:function(){return{}}},onError:{type:Function,default:function(){return{}}},onRemove:{type:Function,default:function(){return{}}},onPreview:{type:Function,default:function(){return{}}},onExceededSize:{type:Function,default:function(){return{}}},onFormatError:{type:Function,default:function(){return{}}},defaultFileList:{type:Array,default:function(){return[]}},maxSelectNum:{type:Number},existNum:{type:Number},index:{type:Number}},data:function(){return{prefixCls:"ivu-upload",dragOver:!1,fileList:[],tempIndex:1}},computed:{classes:function(){var e;return["ivu-upload",(e={},s()(e,"ivu-upload-select","select"===this.type),s()(e,"ivu-upload-drag","drag"===this.type),s()(e,"ivu-upload-dragOver","drag"===this.type&&this.dragOver),e)]}},methods:{handleClick:function(){this.$refs.input.click()},handleChange:function(e){var t=e.target.files;t&&(this.uploadFiles(t),this.$refs.input.value=null)},onDrop:function(e){this.dragOver=!1,this.uploadFiles(e.dataTransfer.files)},uploadFiles:function(e){var t=this,r=Array.prototype.slice.call(e);if(this.maxSelectNum&&r.length>this.maxSelectNum-this.existNum)return erpShopApp.tip("最多只能上传"+this.maxSelectNum+"张图片！","info"),!1;this.multiple||(r=r.slice(0,1)),0!==r.length&&r.forEach(function(e){t.upload(e)})},upload:function(e){var t=this;if(!this.beforeUpload)return this.post(e);var r=this.beforeUpload(e,this.index);r&&r.then?r.then(function(r){"[object File]"===Object.prototype.toString.call(r)?t.post(r):t.post(e)},function(){}):!1!==r&&this.post(e)},post:function(e){var t=this;if(this.format.length){var r=e.name.split(".").pop().toLocaleLowerCase();if(!this.format.some(function(e){return e.toLocaleLowerCase()===r}))return this.onFormatError(e,this.fileList),!1}if(this.maxSize&&e.size>1024*this.maxSize)return this.onExceededSize(e,this.fileList),!1;this.handleStart(e),(new FormData).append(this.name,e),I({headers:this.headers,withCredentials:this.withCredentials,file:e,data:this.data,filename:this.name,action:this.action,onProgress:function(r){t.handleProgress(r,e)},onSuccess:function(r){t.handleSuccess(r,e,t.index)},onError:function(r,n){t.handleError(r,n,e)}})},handleStart:function(e){e.uid=Date.now()+this.tempIndex++;var t={status:"uploading",name:e.name,size:e.size,percentage:0,uid:e.uid,showProgress:!0};this.fileList.push(t)},getFile:function(e){var t=void 0;return this.fileList.every(function(r){return!(t=e.uid===r.uid?r:null)}),t},handleProgress:function(e,t){var r=this.getFile(t);this.onProgress(e,r,this.fileList),r.percentage=e.percent||0},handleSuccess:function(e,t,r){var n=this.getFile(t);n&&(n.status="finished",n.response=e,this.dispatch("FormItem","on-form-change",n),this.onSuccess(e,n,this.fileList,r),setTimeout(function(){n.showProgress=!1},1e3))},handleError:function(e,t,r){var n=this.getFile(r),s=this.fileList;n.status="fail",s.splice(s.indexOf(n),1),this.onError(e,t,r)},handleRemove:function(e){var t=this.fileList;t.splice(t.indexOf(e),1),this.onRemove(e,t)},handlePreview:function(e){"finished"===e.status&&this.onPreview(e)},clearFiles:function(){this.fileList=[]}},watch:{defaultFileList:{immediate:!0,handler:function(e){var t=this;this.fileList=e.map(function(e){return e.status="finished",e.percentage=100,e.uid=Date.now()+t.tempIndex++,e})}}}},y={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:[e.prefixCls]},[r("div",{class:e.classes,on:{click:e.handleClick,drop:function(t){t.preventDefault(),e.onDrop(t)},dragover:function(t){t.preventDefault(),e.dragOver=!0},dragleave:function(t){t.preventDefault(),e.dragOver=!1}}},[r("input",{ref:"input",class:[e.prefixCls+"-input"],attrs:{type:"file",multiple:e.multiple,accept:e.accept},on:{change:e.handleChange}}),e._v(" "),e._t("default")],2),e._v(" "),e._t("tip"),e._v(" "),e.showUploadList?r("upload-list",{attrs:{files:e.fileList},on:{"on-file-remove":e.handleRemove,"on-file-preview":e.handlePreview}}):e._e()],2)},staticRenderFns:[]},x=r("VU/8")(k,y,!1,null,null,null);t.a=x.exports},"E/DE":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Dd8w"),s=r.n(n),i=r("7+uW"),a=r("mtWM"),o=r.n(a),c={data:function(){return{uploadAction:ctx+"/diagnosis/diagnosisForm/upload",taskDefKey:erpShopApp.getQueryString("task_def_key",location.href),procInsId:erpShopApp.getQueryString("procInstId",location.href),serviceType:erpShopApp.getQueryString("serviceType",location.href),visitType:erpShopApp.getQueryString("visitType",location.href),remarkItems:[],remarkItemsSelect:[],paramJson:[],uploadUrl:pageDataObject.uploadfileurl||apiurl.uploadUrl}},computed:{},components:{upload:r("BD2p").a},mounted:function(){this.getData()},methods:{getServiceGoalCode:function(){return"FMPS"===this.serviceType&&"FMPS_M"===this.visitType?"2_":"FMPS"===this.serviceType?"1_":"JYK"===this.serviceType?"3_":"FMPS_BASIC"===this.serviceType?"7_":"VC"===this.serviceType?"6_":"MU"===this.serviceType?"8_":void 0},getData:function(){var e=this,t=this.getServiceGoalCode(),r=-1!==this.taskDefKey.indexOf("visit_service")?t+this.taskDefKey:this.taskDefKey;o.a.get(ctx+"/remarks/workflowRemarksInfo/queryRemarkItems",{params:{workflowKey:"delivery_service_flow",workflowNodeKey:r}}).then(function(t){t.data&&t.data.forEach(function(t){-1!==t.remarkItemType.indexOf("1")&&(t.remarkText=""),-1!==t.remarkItemType.indexOf("4")&&(t.remarkImg=[]),e.remarkItems.push(t)})})},handleBefore:function(e,t){return 5!==this.remarkItems[t].remarkImg.length||(erpShopApp.tip("最多只能上传5张图片！","info"),!1)},handleMaxSize:function(e){erpShopApp.tip("文件 "+e.name+" 太大，不能超过 50M。","info")},handleFormatError:function(e){erpShopApp.tip("文件 "+e.name+" 格式不正确，请上传 jpg 或 png 格式的图片。","info")},handleSuccess:function(e,t,r,n){"0"===e.code?this.remarkItems[n].remarkImg.push(e.attach):erpShopApp.tip("文件上传失败！","info")},deleteImg:function(e,t){this.remarkItems[e].remarkImg.splice(t,1)}},watch:{remarkItemsSelect:{handler:function(e,t){this.paramJson=[];for(var r=0;r<e.length;r++){var n={procInsId:this.procInsId,remarkItemId:e[r].remarkItemId,remarkItemName:e[r].remarkItemName};-1===e[r].remarkItemType.indexOf(",")?(-1!==e[r].remarkItemType.indexOf("1")&&(n.remarkText=e[r].remarkText?e[r].remarkText:"",n.remarkItemType="1"),-1!==e[r].remarkItemType.indexOf("3")&&(n.remarkItemType="3"),-1!==e[r].remarkItemType.indexOf("4")&&(n.remarkText=e[r].remarkImg.length>0?e[r].remarkImg.join(";"):"",n.remarkItemType="4"),this.paramJson.push(n)):e[r].remarkText&&e[r].remarkImg.length>0?(-1!==e[r].remarkItemType.indexOf("1")&&this.paramJson.push({procInsId:this.procInsId,remarkItemId:e[r].remarkItemId,remarkItemType:"1",remarkText:e[r].remarkText,remarkItemName:e[r].remarkItemName}),-1!==e[r].remarkItemType.indexOf("4")&&this.paramJson.push({procInsId:this.procInsId,remarkItemId:e[r].remarkItemId,remarkItemType:"4",remarkText:e[r].remarkImg.join(";"),remarkItemName:e[r].remarkItemName})):e[r].remarkText||e[r].remarkImg.length>0?(e[r].remarkText&&this.paramJson.push({procInsId:this.procInsId,remarkItemId:e[r].remarkItemId,remarkItemType:"1",remarkText:e[r].remarkText,remarkItemName:e[r].remarkItemName}),e[r].remarkImg.length>0&&this.paramJson.push({procInsId:this.procInsId,remarkItemId:e[r].remarkItemId,remarkItemType:"4",remarkText:e[r].remarkImg.join(";"),remarkItemName:e[r].remarkItemName})):this.paramJson.push({procInsId:this.procInsId,remarkItemId:e[r].remarkItemId,remarkItemType:"1",remarkText:"",remarkItemName:e[r].remarkItemName})}},deep:!0}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"remark-content"},[r("p",{staticClass:"desription"},[e._v("记录服务中商户反馈的重要信息或出现的异常情况：")]),e._v(" "),r("div",{staticClass:"item-content"},e._l(e.remarkItems,function(t,n){return r("div",{staticClass:"item"},[r("div",[r("input",{directives:[{name:"model",rawName:"v-model",value:e.remarkItemsSelect,expression:"remarkItemsSelect"}],attrs:{id:n,type:"checkbox"},domProps:{value:t,checked:Array.isArray(e.remarkItemsSelect)?e._i(e.remarkItemsSelect,t)>-1:e.remarkItemsSelect},on:{change:function(r){var n=e.remarkItemsSelect,s=r.target,i=!!s.checked;if(Array.isArray(n)){var a=t,o=e._i(n,a);s.checked?o<0&&(e.remarkItemsSelect=n.concat([a])):o>-1&&(e.remarkItemsSelect=n.slice(0,o).concat(n.slice(o+1)))}else e.remarkItemsSelect=i}}}),e._v(" "),r("label",{attrs:{for:n}},[e._v(e._s(t.remarkItemName))])]),e._v(" "),-1!==t.remarkItemType.indexOf("1")?r("div",{staticStyle:{"margin-left":"20px"}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.remarkText,expression:"item.remarkText"}],attrs:{maxlength:"100",placeholder:"输入备注内容"},domProps:{value:t.remarkText},on:{input:function(r){r.target.composing||e.$set(t,"remarkText",r.target.value)}}})]):e._e(),e._v(" "),-1!==t.remarkItemType.indexOf("4")?r("div",{staticStyle:{"margin-left":"20px"}},[e._l(t.remarkImg,function(t,s){return r("div",{staticClass:"img-content"},[r("div",[r("img",{attrs:{src:e.uploadUrl+"/"+t}})]),e._v(" "),r("div",[r("button",{staticClass:"ios-trash-outline",on:{click:function(t){e.deleteImg(n,s)}}},[e._v("删除")])])])}),e._v(" "),r("upload",{ref:"audit",refInFor:!0,staticStyle:{display:"inline-block",width:"76px"},attrs:{type:"drag",index:n,"on-success":e.handleSuccess,"on-format-error":e.handleFormatError,"on-exceeded-size":e.handleMaxSize,format:["jpg","jpeg","png","gif"],accept:"image/*","max-size":51200,"before-upload":e.handleBefore,action:e.uploadAction}},[r("div",{staticStyle:{width:"76px",height:"76px","line-height":"76px","text-align":"center"}},[r("span",[r("i",{staticClass:"icon-camera"}),e._v("上传")])])])],2):e._e()])})),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:JSON.stringify(e.paramJson),expression:"JSON.stringify(paramJson)"}],attrs:{type:"hidden",id:"remarks",name:"formDataInput"},domProps:{value:JSON.stringify(e.paramJson)},on:{input:function(t){t.target.composing||e.$set(JSON,"stringify(paramJson)",t.target.value)}}})])},staticRenderFns:[]};var l=r("VU/8")(c,u,!1,function(e){r("Q6nr")},null,null).exports;i.default.config.productionTip=!1,i.default.config.devtools=!1,new i.default(s()({},l)).$mount("#rootNode")},Q6nr:function(e,t){}},["E/DE"]);