webpackJsonp([103],{BD2p:function(t,e,n){"use strict";var s=n("bOdI"),a=n.n(s),i={name:"Icon",props:{type:String,size:[Number,String],color:String},computed:{classes:function(){return"ivu-icon ivu-icon-"+this.type},styles:function(){var t={};return this.size&&(t["font-size"]=this.size+"px"),this.color&&(t.color=this.color),t}}},r={render:function(){var t=this.$createElement;return(this._self._c||t)("i",{class:this.classes,style:this.styles})},staticRenderFns:[]},o=n("VU/8")(i,r,!1,null,null,null).exports,l=(n("BO1k"),n("7+uW").default.prototype.$isServer);function u(t,e){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}!l&&(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver);var c={components:{Icon:o},props:{percent:{type:Number,default:0},status:{validator:function(t){return u(t,["normal","active","wrong","success"])},default:"normal"},hideInfo:{type:Boolean,default:!1},strokeWidth:{type:Number,default:10},vertical:{type:Boolean,default:!1}},data:function(){return{currentStatus:this.status}},computed:{isStatus:function(){return"wrong"==this.currentStatus||"success"==this.currentStatus},statusIcon:function(){var t="";switch(this.currentStatus){case"wrong":t="ios-close";break;case"success":t="ios-checkmark"}return t},bgStyle:function(){return this.vertical?{height:this.percent+"%",width:this.strokeWidth+"px"}:{width:this.percent+"%",height:this.strokeWidth+"px"}},wrapClasses:function(){var t;return["ivu-progress","ivu-progress-"+this.currentStatus,(t={},a()(t,"ivu-progress-show-info",!this.hideInfo),a()(t,"ivu-progress-vertical",this.vertical),t)]},textClasses:function(){return"ivu-progress-text"},textInnerClasses:function(){return"ivu-progress-text-inner"},outerClasses:function(){return"ivu-progress-outer"},innerClasses:function(){return"ivu-progress-inner"},bgClasses:function(){return"ivu-progress-bg"}},created:function(){this.handleStatus()},methods:{handleStatus:function(t){t?(this.currentStatus="normal",this.$emit("on-status-change","normal")):100==parseInt(this.percent,10)&&(this.currentStatus="success",this.$emit("on-status-change","success"))}},watch:{percent:function(t,e){t<e?this.handleStatus(!0):this.handleStatus()},status:function(t){this.currentStatus=t}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.wrapClasses},[n("div",{class:t.outerClasses},[n("div",{class:t.innerClasses},[n("div",{class:t.bgClasses,style:t.bgStyle})])]),t._v(" "),t.hideInfo?t._e():n("span",{class:t.textClasses},[t._t("default",[t.isStatus?n("span",{class:t.textInnerClasses},[n("Icon",{attrs:{type:t.statusIcon}})],1):n("span",{class:t.textInnerClasses},[t._v("\n                "+t._s(t.percent)+"%\n            ")])])],2)])},staticRenderFns:[]},d={name:"UploadList",components:{Icon:o,iProgress:n("VU/8")(c,p,!1,null,null,null).exports},props:{files:{type:Array,default:function(){return[]}}},data:function(){return{prefixCls:"ivu-upload"}},methods:{fileCls:function(t){return["ivu-upload-list-file",a()({},"ivu-upload-list-file-finish","finished"===t.status)]},handleClick:function(t){this.$emit("on-file-click",t)},handlePreview:function(t){this.$emit("on-file-preview",t)},handleRemove:function(t){this.$emit("on-file-remove",t)},format:function(t){var e=t.name.split(".").pop().toLocaleLowerCase()||"",n="document";return["gif","jpg","jpeg","png","bmp","webp"].indexOf(e)>-1&&(n="image"),["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(e)>-1&&(n="ios-film"),["mp3","wav","wma","ogg","aac","flac"].indexOf(e)>-1&&(n="ios-musical-notes"),["doc","txt","docx","pages","epub","pdf"].indexOf(e)>-1&&(n="document-text"),["numbers","csv","xls","xlsx"].indexOf(e)>-1&&(n="stats-bars"),["keynote","ppt","pptx"].indexOf(e)>-1&&(n="ios-videocam"),n},parsePercentage:function(t){return parseInt(t,10)}}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{class:[t.prefixCls+"-list"]},t._l(t.files,function(e){return n("li",{class:t.fileCls(e),on:{click:function(n){t.handleClick(e)}}},[n("span",{on:{click:function(n){t.handlePreview(e)}}},[n("Icon",{attrs:{type:t.format(e)}}),t._v(" "+t._s(e.name)+"\n        ")],1),t._v(" "),n("Icon",{directives:[{name:"show",rawName:"v-show",value:"finished"===e.status,expression:"file.status === 'finished'"}],class:[t.prefixCls+"-list-remove"],attrs:{type:"ios-close-empty"},nativeOn:{click:function(n){t.handleRemove(e)}}}),t._v(" "),n("transition",{attrs:{name:"fade"}},[e.showProgress?n("i-progress",{attrs:{"stroke-width":2,percent:t.parsePercentage(e.percentage),status:"finished"===e.status&&e.showProgress?"success":"normal"}}):t._e()],1)],1)}))},staticRenderFns:[]},h=n("VU/8")(d,f,!1,null,null,null).exports,m=n("fZjL"),v=n.n(m);function g(t){var e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch(t){return e}}function y(t){if("undefined"!=typeof XMLHttpRequest){var e=new XMLHttpRequest,n=t.action;e.upload&&(e.upload.onprogress=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.onProgress(e)});var s=new FormData;t.data&&v()(t.data).map(function(e){s.append(e,t.data[e])}),s.append(t.filename,t.file),e.onerror=function(e){t.onError(e)},e.onload=function(){if(e.status<200||e.status>=300)return t.onError(function(t,e,n){var s="fail to post "+t+" "+n.status+"'",a=new Error(s);return a.status=n.status,a.method="post",a.url=t,a}(n,0,e),g(e));t.onSuccess(g(e))},e.open("post",n,!0),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);var a=t.headers||{};for(var i in a)a.hasOwnProperty(i)&&null!==a[i]&&e.setRequestHeader(i,a[i]);e.send(s)}}var x={name:"Upload",mixins:[{methods:{dispatch:function(t,e,n){for(var s=this.$parent||this.$root,a=s.$options.name;s&&(!a||a!==t);)(s=s.$parent)&&(a=s.$options.name);s&&s.$emit.apply(s,[e].concat(n))},broadcast:function(t,e,n){(function t(e,n,s){this.$children.forEach(function(a){a.$options.name===e?a.$emit.apply(a,[n].concat(s)):t.apply(a,[e,n].concat([s]))})}).call(this,t,e,n)}}}],components:{UploadList:h},props:{action:{type:String,required:!0},headers:{type:Object,default:function(){return{}}},multiple:{type:Boolean,default:!1},data:{type:Object},name:{type:String,default:"file"},withCredentials:{type:Boolean,default:!1},showUploadList:{type:Boolean,default:!0},type:{type:String,validator:function(t){return u(t,["select","drag"])},default:"select"},format:{type:Array,default:function(){return[]}},accept:{type:String},maxSize:{type:Number},beforeUpload:Function,onProgress:{type:Function,default:function(){return{}}},onSuccess:{type:Function,default:function(){return{}}},onError:{type:Function,default:function(){return{}}},onRemove:{type:Function,default:function(){return{}}},onPreview:{type:Function,default:function(){return{}}},onExceededSize:{type:Function,default:function(){return{}}},onFormatError:{type:Function,default:function(){return{}}},defaultFileList:{type:Array,default:function(){return[]}},maxSelectNum:{type:Number},existNum:{type:Number},index:{type:Number}},data:function(){return{prefixCls:"ivu-upload",dragOver:!1,fileList:[],tempIndex:1}},computed:{classes:function(){var t;return["ivu-upload",(t={},a()(t,"ivu-upload-select","select"===this.type),a()(t,"ivu-upload-drag","drag"===this.type),a()(t,"ivu-upload-dragOver","drag"===this.type&&this.dragOver),t)]}},methods:{handleClick:function(){this.$refs.input.click()},handleChange:function(t){var e=t.target.files;e&&(this.uploadFiles(e),this.$refs.input.value=null)},onDrop:function(t){this.dragOver=!1,this.uploadFiles(t.dataTransfer.files)},uploadFiles:function(t){var e=this,n=Array.prototype.slice.call(t);if(this.maxSelectNum&&n.length>this.maxSelectNum-this.existNum)return erpShopApp.tip("最多只能上传"+this.maxSelectNum+"张图片！","info"),!1;this.multiple||(n=n.slice(0,1)),0!==n.length&&n.forEach(function(t){e.upload(t)})},upload:function(t){var e=this;if(!this.beforeUpload)return this.post(t);var n=this.beforeUpload(t,this.index);n&&n.then?n.then(function(n){"[object File]"===Object.prototype.toString.call(n)?e.post(n):e.post(t)},function(){}):!1!==n&&this.post(t)},post:function(t){var e=this;if(this.format.length){var n=t.name.split(".").pop().toLocaleLowerCase();if(!this.format.some(function(t){return t.toLocaleLowerCase()===n}))return this.onFormatError(t,this.fileList),!1}if(this.maxSize&&t.size>1024*this.maxSize)return this.onExceededSize(t,this.fileList),!1;this.handleStart(t),(new FormData).append(this.name,t),y({headers:this.headers,withCredentials:this.withCredentials,file:t,data:this.data,filename:this.name,action:this.action,onProgress:function(n){e.handleProgress(n,t)},onSuccess:function(n){e.handleSuccess(n,t,e.index)},onError:function(n,s){e.handleError(n,s,t)}})},handleStart:function(t){t.uid=Date.now()+this.tempIndex++;var e={status:"uploading",name:t.name,size:t.size,percentage:0,uid:t.uid,showProgress:!0};this.fileList.push(e)},getFile:function(t){var e=void 0;return this.fileList.every(function(n){return!(e=t.uid===n.uid?n:null)}),e},handleProgress:function(t,e){var n=this.getFile(e);this.onProgress(t,n,this.fileList),n.percentage=t.percent||0},handleSuccess:function(t,e,n){var s=this.getFile(e);s&&(s.status="finished",s.response=t,this.dispatch("FormItem","on-form-change",s),this.onSuccess(t,s,this.fileList,n),setTimeout(function(){s.showProgress=!1},1e3))},handleError:function(t,e,n){var s=this.getFile(n),a=this.fileList;s.status="fail",a.splice(a.indexOf(s),1),this.onError(t,e,n)},handleRemove:function(t){var e=this.fileList;e.splice(e.indexOf(t),1),this.onRemove(t,e)},handlePreview:function(t){"finished"===t.status&&this.onPreview(t)},clearFiles:function(){this.fileList=[]}},watch:{defaultFileList:{immediate:!0,handler:function(t){var e=this;this.fileList=t.map(function(t){return t.status="finished",t.percentage=100,t.uid=Date.now()+e.tempIndex++,t})}}}},w={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:[t.prefixCls]},[n("div",{class:t.classes,on:{click:t.handleClick,drop:function(e){e.preventDefault(),t.onDrop(e)},dragover:function(e){e.preventDefault(),t.dragOver=!0},dragleave:function(e){e.preventDefault(),t.dragOver=!1}}},[n("input",{ref:"input",class:[t.prefixCls+"-input"],attrs:{type:"file",multiple:t.multiple,accept:t.accept},on:{change:t.handleChange}}),t._v(" "),t._t("default")],2),t._v(" "),t._t("tip"),t._v(" "),t.showUploadList?n("upload-list",{attrs:{files:t.fileList},on:{"on-file-remove":t.handleRemove,"on-file-preview":t.handlePreview}}):t._e()],2)},staticRenderFns:[]},S=n("VU/8")(x,w,!1,null,null,null);e.a=S.exports},rOfM:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("Dd8w"),a=n.n(s),i=n("7+uW"),r=n("mvHQ"),o=n.n(r),l=n("mtWM"),u=n.n(l),c={data:function(){return{formData:{orderId:"",splitId:"",pdfUrl:"",id:"",state:"",pdfName:"",dataType:erpApp.getQueryString("data",location.href).split(",")[1],procInsId:erpApp.getQueryString("data",location.href).split(",")[0]},ctx:ctx,pdfImg:ctxStatic+"/images/pdf.jpg",isEdit:!0,enabled:!0,uploadUrl:__uploadurl__,uploadAction:ctx+"/workfile/file/onlyUpload"}},computed:{formDatas:function(){return this.formData}},components:{upload:n("BD2p").a},mounted:function(){this.getInfo()},methods:{getInfo:function(){var t=this,e=this.formData,n=e.procInsId,s=e.dataType;u.a.get(ctx+"/dataPresentation/getInfo?procInsId="+n+"&dataType="+s).then(function(e){"0"===e.data.code&&(t.formData=erpApp.extend(t.formData,e.data.attach),"1"===e.data.attach.state?t.enabled=!1:t.enabled=!0)})},save:function(t){var e=this;if(this.formDatas.state=t,""===this.formDatas.pdfUrl.trim())return erpApp.tip("请上传PDF格式的推广数据报告文档！"),!1;u()({method:"post",url:ctx+"/dataPresentation/save",data:{data:this.formDatas},transformRequest:[function(t){var e="";for(var n in t)e+=encodeURIComponent(n)+"="+o()(t[n])+"&";return e}],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(n){var s,a;"0"===n.data.code&&"1"===t?erpApp.tip("保存成功！","info"):"0"===n.data.code&&"2"===t?(erpApp.tip("发布到小程序成功！","info"),s=ctx+"/message/erpServiceSchedule/saveProgress",a=1===Number(e.formData.dataType)?[{procInsId:e.formData.procInsId,serviceType:"SplitJuYinKe",status:"End",type:"FirstPromotionReport"}]:[{procInsId:e.formData.procInsId,serviceType:"SplitJuYinKe",status:"End",type:"LastPromotionReport"}],u.a.get(s,{params:{paramJson:o()(a)}}),pageDataObject.runSaveMessageRecord&&function(){var t=ctx+"/message/erpServiceMessage/saveMessageRecord",n=1===Number(e.formData.dataType)?[{procInsId:e.formData.procInsId,serviceType:"SplitJuYinKe",status:"End",nodeType:"PromotionProgramOnline"},{procInsId:e.formData.procInsId,serviceType:"SplitJuYinKe",status:"Begin",nodeType:"FirstPromotionReport"}]:[{procInsId:e.formData.procInsId,serviceType:"SplitJuYinKe",status:"Begin",nodeType:"LastPromotionReport"}];u.a.get(t,{params:{paramJson:o()(n)}})}()):"1"===n.data.code&&erpApp.tip(n.data.message,"info"),e.getInfo()}).catch(function(t){erpApp.tip("操作失败，请稍后重试！","error")})},handleSuccesss:function(t,e){"SUCCESS"===t.state?(this.formData.pdfUrl=t.url,this.formData.pdfName=t.fileName):erpApp.tip("文件 "+e.name+"上传失败！","error")},handleFormatError:function(t){erpApp.tip("文件 "+t.name+" 格式不正确，请上传 PDF 格式的文档。","error")},handleMaxSize:function(t){erpApp.tip("文件 "+t.name+" 太大，不能超过 50M。","error")}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"store"},[n("div",{staticClass:"padding10 shopbaseinfo-wrapper"},[n("div",{staticClass:"swrapper"},[n("div",{staticClass:"clearboth margin-bottom-10 storebaseinfo-wrapper"},[n("div",{staticClass:"form-horizontal clearboth erpstore-horizontal"},[n("div",{staticClass:"control-group"},[n("label",{staticClass:"control-label"},[t._v("首日推广数据报告：")]),t._v(" "),n("div",{staticClass:"controls"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.formData.pdfUrl||t.formData.pdfName,expression:"formData.pdfUrl || formData.pdfName"}],staticClass:"unionPictures"},[n("img",{staticStyle:{width:"180px"},attrs:{src:t.pdfImg,alt:"内层落地页图"}}),t._v(" "),n("p",{staticStyle:{width:"180px","text-align":"center"}},[t._v(t._s(t.formData.pdfName))])]),t._v(" "),n("div",{staticClass:"bottomInfo"},[t.isEdit?n("div",{staticClass:"uploadWrapper"},[n("upload",{ref:"uploadImgsi",staticStyle:{display:"inline-block",width:"55px"},attrs:{type:"drag","show-upload-list":!1,"on-success":t.handleSuccesss,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize,format:["pdf","PDF"],data:{splitId:t.procInsId},"max-size":51200,action:t.uploadAction}},[n("div",{staticStyle:{width:"55px",height:"30px","line-height":"30px","text-align":"center"}},[n("span",[n("i",{staticClass:"icon-camera"}),t._v(t._s(t.formData.pdfUrl?"修改":"上传"))])])])],1):t._e()])])])])])]),t._v(" "),n("div",{staticClass:"form-actions store-form-actions"},[n("input",{staticClass:"savebtn btn btn-primary",attrs:{id:"btnSave",type:"button",value:"保 存"},on:{click:function(e){t.save("1")}}}),t._v(" "),n("input",{staticClass:"savebtn btn btn-primary",staticStyle:{"margin-left":"10px"},attrs:{id:"btnPbulic",type:"button",value:"发布到小程序",disabled:t.enabled},on:{click:function(e){t.save("2")}}})])])])},staticRenderFns:[]},d=n("VU/8")(c,p,!1,null,null,null).exports;i.default.config.productionTip=!1,i.default.config.devtools=!1,new i.default(a()({},d)).$mount("#rootNode")}},["rOfM"]);